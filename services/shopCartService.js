import prisma from "../models/prisma";

const getCart = async (userid) => {
    try{
        const cart = await prisma.shopCart.findMany({
            where: {
                user_id: userid
            }
        })
        return cart
    }
    catch(err) {
        return err
    }
}

const getQuantity = async (userid, product_id) => {
    try{
        const cart = await prisma.shopCart.findFirst({
            where: {
                user_id: userid,
                product_id: product_id
            }
        })
        return cart.quantity
    }
    catch(err) {
        return err
    }
}

const addCart = async (user_id, product_id, quantity) => {
    try {
        const product = await prisma.product.findUnique({
            where: {
                slug: product_id
            }
        })
        const test = await prisma.shopCart.create({
            data: {
                product_id: product.id,
                user_id: user_id,
                quantity: parseInt(quantity)
            }
        })
    }
    catch(err){
        console.log(err)
        return err
    }
}

const clearAllCart = async (user_id) => {
    try {
        await prisma.shopCart.deleteMany({
            where:{
                user_id: user_id
            }
        })
    }
    catch(err) {
        return err
    }
}

const deleteCart = async (user_id, product_id) => {
    try {
        user_id = parseInt(user_id)
        product_id = parseInt(product_id)
        await prisma.shopCart.delete({
            where: {
                user_id: user_id,
                product_id: product_id
            },
        })
    }   
    catch(err) {
        return err
    }
}

export default {addCart, getCart, getQuantity, clearAllCart, deleteCart}